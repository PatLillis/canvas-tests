{"version":3,"sources":["../../javascript/Projector.js"],"names":[],"mappings":"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","file":"Projector.js","sourcesContent":["/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author julianwa / https://github.com/julianwa\r\n */\r\n\r\nTHREE.RenderableObject = function () {\r\n\r\n\tthis.id = 0;\r\n\r\n\tthis.object = null;\r\n\tthis.z = 0;\r\n\tthis.renderOrder = 0;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.RenderableFace = function () {\r\n\r\n\tthis.id = 0;\r\n\r\n\tthis.v1 = new THREE.RenderableVertex();\r\n\tthis.v2 = new THREE.RenderableVertex();\r\n\tthis.v3 = new THREE.RenderableVertex();\r\n\r\n\tthis.normalModel = new THREE.Vector3();\r\n\r\n\tthis.vertexNormalsModel = [ new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3() ];\r\n\tthis.vertexNormalsLength = 0;\r\n\r\n\tthis.color = new THREE.Color();\r\n\tthis.material = null;\r\n\tthis.uvs = [ new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2() ];\r\n\r\n\tthis.z = 0;\r\n\tthis.renderOrder = 0;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.RenderableVertex = function () {\r\n\r\n\tthis.position = new THREE.Vector3();\r\n\tthis.positionWorld = new THREE.Vector3();\r\n\tthis.positionScreen = new THREE.Vector4();\r\n\r\n\tthis.visible = true;\r\n\r\n};\r\n\r\nTHREE.RenderableVertex.prototype.copy = function ( vertex ) {\r\n\r\n\tthis.positionWorld.copy( vertex.positionWorld );\r\n\tthis.positionScreen.copy( vertex.positionScreen );\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.RenderableLine = function () {\r\n\r\n\tthis.id = 0;\r\n\r\n\tthis.v1 = new THREE.RenderableVertex();\r\n\tthis.v2 = new THREE.RenderableVertex();\r\n\r\n\tthis.vertexColors = [ new THREE.Color(), new THREE.Color() ];\r\n\tthis.material = null;\r\n\r\n\tthis.z = 0;\r\n\tthis.renderOrder = 0;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.RenderableSprite = function () {\r\n\r\n\tthis.id = 0;\r\n\r\n\tthis.object = null;\r\n\r\n\tthis.x = 0;\r\n\tthis.y = 0;\r\n\tthis.z = 0;\r\n\r\n\tthis.rotation = 0;\r\n\tthis.scale = new THREE.Vector2();\r\n\r\n\tthis.material = null;\r\n\tthis.renderOrder = 0;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.Projector = function () {\r\n\r\n\tvar _object, _objectCount, _objectPool = [], _objectPoolLength = 0,\r\n\t_vertex, _vertexCount, _vertexPool = [], _vertexPoolLength = 0,\r\n\t_face, _faceCount, _facePool = [], _facePoolLength = 0,\r\n\t_line, _lineCount, _linePool = [], _linePoolLength = 0,\r\n\t_sprite, _spriteCount, _spritePool = [], _spritePoolLength = 0,\r\n\r\n\t_renderData = { objects: [], lights: [], elements: [] },\r\n\r\n\t_vector3 = new THREE.Vector3(),\r\n\t_vector4 = new THREE.Vector4(),\r\n\r\n\t_clipBox = new THREE.Box3( new THREE.Vector3( - 1, - 1, - 1 ), new THREE.Vector3( 1, 1, 1 ) ),\r\n\t_boundingBox = new THREE.Box3(),\r\n\t_points3 = new Array( 3 ),\r\n\t_points4 = new Array( 4 ),\r\n\r\n\t_viewMatrix = new THREE.Matrix4(),\r\n\t_viewProjectionMatrix = new THREE.Matrix4(),\r\n\r\n\t_modelMatrix,\r\n\t_modelViewProjectionMatrix = new THREE.Matrix4(),\r\n\r\n\t_normalMatrix = new THREE.Matrix3(),\r\n\r\n\t_frustum = new THREE.Frustum(),\r\n\r\n\t_clippedVertex1PositionScreen = new THREE.Vector4(),\r\n\t_clippedVertex2PositionScreen = new THREE.Vector4();\r\n\r\n\t//\r\n\r\n\tthis.projectVector = function ( vector, camera ) {\r\n\r\n\t\tconsole.warn( 'THREE.Projector: .projectVector() is now vector.project().' );\r\n\t\tvector.project( camera );\r\n\r\n\t};\r\n\r\n\tthis.unprojectVector = function ( vector, camera ) {\r\n\r\n\t\tconsole.warn( 'THREE.Projector: .unprojectVector() is now vector.unproject().' );\r\n\t\tvector.unproject( camera );\r\n\r\n\t};\r\n\r\n\tthis.pickingRay = function ( vector, camera ) {\r\n\r\n\t\tconsole.error( 'THREE.Projector: .pickingRay() is now raycaster.setFromCamera().' );\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tvar RenderList = function () {\r\n\r\n\t\tvar normals = [];\r\n\t\tvar uvs = [];\r\n\r\n\t\tvar object = null;\r\n\t\tvar material = null;\r\n\r\n\t\tvar normalMatrix = new THREE.Matrix3();\r\n\r\n\t\tvar setObject = function ( value ) {\r\n\r\n\t\t\tobject = value;\r\n\t\t\tmaterial = object.material;\r\n\r\n\t\t\tnormalMatrix.getNormalMatrix( object.matrixWorld );\r\n\r\n\t\t\tnormals.length = 0;\r\n\t\t\tuvs.length = 0;\r\n\r\n\t\t};\r\n\r\n\t\tvar projectVertex = function ( vertex ) {\r\n\r\n\t\t\tvar position = vertex.position;\r\n\t\t\tvar positionWorld = vertex.positionWorld;\r\n\t\t\tvar positionScreen = vertex.positionScreen;\r\n\r\n\t\t\tpositionWorld.copy( position ).applyMatrix4( _modelMatrix );\r\n\t\t\tpositionScreen.copy( positionWorld ).applyMatrix4( _viewProjectionMatrix );\r\n\r\n\t\t\tvar invW = 1 / positionScreen.w;\r\n\r\n\t\t\tpositionScreen.x *= invW;\r\n\t\t\tpositionScreen.y *= invW;\r\n\t\t\tpositionScreen.z *= invW;\r\n\r\n\t\t\tvertex.visible = positionScreen.x >= - 1 && positionScreen.x <= 1 &&\r\n\t\t\t\t\t positionScreen.y >= - 1 && positionScreen.y <= 1 &&\r\n\t\t\t\t\t positionScreen.z >= - 1 && positionScreen.z <= 1;\r\n\r\n\t\t};\r\n\r\n\t\tvar pushVertex = function ( x, y, z ) {\r\n\r\n\t\t\t_vertex = getNextVertexInPool();\r\n\t\t\t_vertex.position.set( x, y, z );\r\n\r\n\t\t\tprojectVertex( _vertex );\r\n\r\n\t\t};\r\n\r\n\t\tvar pushNormal = function ( x, y, z ) {\r\n\r\n\t\t\tnormals.push( x, y, z );\r\n\r\n\t\t};\r\n\r\n\t\tvar pushUv = function ( x, y ) {\r\n\r\n\t\t\tuvs.push( x, y );\r\n\r\n\t\t};\r\n\r\n\t\tvar checkTriangleVisibility = function ( v1, v2, v3 ) {\r\n\r\n\t\t\tif ( v1.visible === true || v2.visible === true || v3.visible === true ) return true;\r\n\r\n\t\t\t_points3[ 0 ] = v1.positionScreen;\r\n\t\t\t_points3[ 1 ] = v2.positionScreen;\r\n\t\t\t_points3[ 2 ] = v3.positionScreen;\r\n\r\n\t\t\treturn _clipBox.isIntersectionBox( _boundingBox.setFromPoints( _points3 ) );\r\n\r\n\t\t};\r\n\r\n\t\tvar checkBackfaceCulling = function ( v1, v2, v3 ) {\r\n\r\n\t\t\treturn ( ( v3.positionScreen.x - v1.positionScreen.x ) *\r\n\t\t\t\t    ( v2.positionScreen.y - v1.positionScreen.y ) -\r\n\t\t\t\t    ( v3.positionScreen.y - v1.positionScreen.y ) *\r\n\t\t\t\t    ( v2.positionScreen.x - v1.positionScreen.x ) ) < 0;\r\n\r\n\t\t};\r\n\r\n\t\tvar pushLine = function ( a, b ) {\r\n\r\n\t\t\tvar v1 = _vertexPool[ a ];\r\n\t\t\tvar v2 = _vertexPool[ b ];\r\n\r\n\t\t\t_line = getNextLineInPool();\r\n\r\n\t\t\t_line.id = object.id;\r\n\t\t\t_line.v1.copy( v1 );\r\n\t\t\t_line.v2.copy( v2 );\r\n\t\t\t_line.z = ( v1.positionScreen.z + v2.positionScreen.z ) / 2;\r\n\t\t\t_line.renderOrder = object.renderOrder;\r\n\r\n\t\t\t_line.material = object.material;\r\n\r\n\t\t\t_renderData.elements.push( _line );\r\n\r\n\t\t};\r\n\r\n\t\tvar pushTriangle = function ( a, b, c ) {\r\n\r\n\t\t\tvar v1 = _vertexPool[ a ];\r\n\t\t\tvar v2 = _vertexPool[ b ];\r\n\t\t\tvar v3 = _vertexPool[ c ];\r\n\r\n\t\t\tif ( checkTriangleVisibility( v1, v2, v3 ) === false ) return;\r\n\r\n\t\t\tif ( material.side === THREE.DoubleSide || checkBackfaceCulling( v1, v2, v3 ) === true ) {\r\n\r\n\t\t\t\t_face = getNextFaceInPool();\r\n\r\n\t\t\t\t_face.id = object.id;\r\n\t\t\t\t_face.v1.copy( v1 );\r\n\t\t\t\t_face.v2.copy( v2 );\r\n\t\t\t\t_face.v3.copy( v3 );\r\n\t\t\t\t_face.z = ( v1.positionScreen.z + v2.positionScreen.z + v3.positionScreen.z ) / 3;\r\n\t\t\t\t_face.renderOrder = object.renderOrder;\r\n\r\n\t\t\t\t// use first vertex normal as face normal\r\n\r\n\t\t\t\t_face.normalModel.fromArray( normals, a * 3 );\r\n\t\t\t\t_face.normalModel.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t\tfor ( var i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\tvar normal = _face.vertexNormalsModel[ i ];\r\n\t\t\t\t\tnormal.fromArray( normals, arguments[ i ] * 3 );\r\n\t\t\t\t\tnormal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t\t\tvar uv = _face.uvs[ i ];\r\n\t\t\t\t\tuv.fromArray( uvs, arguments[ i ] * 2 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_face.vertexNormalsLength = 3;\r\n\r\n\t\t\t\t_face.material = object.material;\r\n\r\n\t\t\t\t_renderData.elements.push( _face );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tsetObject: setObject,\r\n\t\t\tprojectVertex: projectVertex,\r\n\t\t\tcheckTriangleVisibility: checkTriangleVisibility,\r\n\t\t\tcheckBackfaceCulling: checkBackfaceCulling,\r\n\t\t\tpushVertex: pushVertex,\r\n\t\t\tpushNormal: pushNormal,\r\n\t\t\tpushUv: pushUv,\r\n\t\t\tpushLine: pushLine,\r\n\t\t\tpushTriangle: pushTriangle\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar renderList = new RenderList();\r\n\r\n\tthis.projectScene = function ( scene, camera, sortObjects, sortElements ) {\r\n\r\n\t\t_faceCount = 0;\r\n\t\t_lineCount = 0;\r\n\t\t_spriteCount = 0;\r\n\r\n\t\t_renderData.elements.length = 0;\r\n\r\n\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\r\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\r\n\r\n\t\t_viewMatrix.copy( camera.matrixWorldInverse.getInverse( camera.matrixWorld ) );\r\n\t\t_viewProjectionMatrix.multiplyMatrices( camera.projectionMatrix, _viewMatrix );\r\n\r\n\t\t_frustum.setFromMatrix( _viewProjectionMatrix );\r\n\r\n\t\t//\r\n\r\n\t\t_objectCount = 0;\r\n\r\n\t\t_renderData.objects.length = 0;\r\n\t\t_renderData.lights.length = 0;\r\n\r\n\t\tscene.traverseVisible( function ( object ) {\r\n\r\n\t\t\tif ( object instanceof THREE.Light ) {\r\n\r\n\t\t\t\t_renderData.lights.push( object );\r\n\r\n\t\t\t} else if ( object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.Sprite ) {\r\n\r\n\t\t\t\tvar material = object.material;\r\n\r\n\t\t\t\tif ( material.visible === false ) return;\r\n\r\n\t\t\t\tif ( object.frustumCulled === false || _frustum.intersectsObject( object ) === true ) {\r\n\r\n\t\t\t\t\t_object = getNextObjectInPool();\r\n\t\t\t\t\t_object.id = object.id;\r\n\t\t\t\t\t_object.object = object;\r\n\r\n\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld );\r\n\t\t\t\t\t_vector3.applyProjection( _viewProjectionMatrix );\r\n\t\t\t\t\t_object.z = _vector3.z;\r\n\t\t\t\t\t_object.renderOrder = object.renderOrder;\r\n\r\n\t\t\t\t\t_renderData.objects.push( _object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tif ( sortObjects === true ) {\r\n\r\n\t\t\t_renderData.objects.sort( painterSort );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tfor ( var o = 0, ol = _renderData.objects.length; o < ol; o ++ ) {\r\n\r\n\t\t\tvar object = _renderData.objects[ o ].object;\r\n\t\t\tvar geometry = object.geometry;\r\n\r\n\t\t\trenderList.setObject( object );\r\n\r\n\t\t\t_modelMatrix = object.matrixWorld;\r\n\r\n\t\t\t_vertexCount = 0;\r\n\r\n\t\t\tif ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\t\t\tvar attributes = geometry.attributes;\r\n\t\t\t\t\tvar groups = geometry.groups;\r\n\r\n\t\t\t\t\tif ( attributes.position === undefined ) continue;\r\n\r\n\t\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\t\tfor ( var i = 0, l = positions.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\trenderList.pushVertex( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( attributes.normal !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar normals = attributes.normal.array;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = normals.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\trenderList.pushNormal( normals[ i ], normals[ i + 1 ], normals[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( attributes.uv !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar uvs = attributes.uv.array;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = uvs.length; i < l; i += 2 ) {\r\n\r\n\t\t\t\t\t\t\trenderList.pushUv( uvs[ i ], uvs[ i + 1 ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( geometry.index !== null ) {\r\n\r\n\t\t\t\t\t\tvar indices = geometry.index.array;\r\n\r\n\t\t\t\t\t\tif ( groups.length > 0 ) {\r\n\r\n\t\t\t\t\t\t\tfor ( var o = 0; o < groups.length; o ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvar group = groups[ o ];\r\n\r\n\t\t\t\t\t\t\t\tfor ( var i = group.start, l = group.start + group.count; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\t\t\trenderList.pushTriangle( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\t\trenderList.pushTriangle( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = positions.length / 3; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\trenderList.pushTriangle( i, i + 1, i + 2 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\t\t\tvar vertices = geometry.vertices;\r\n\t\t\t\t\tvar faces = geometry.faces;\r\n\t\t\t\t\tvar faceVertexUvs = geometry.faceVertexUvs[ 0 ];\r\n\r\n\t\t\t\t\t_normalMatrix.getNormalMatrix( _modelMatrix );\r\n\r\n\t\t\t\t\tvar material = object.material;\r\n\r\n\t\t\t\t\tvar isFaceMaterial = material instanceof THREE.MeshFaceMaterial;\r\n\t\t\t\t\tvar objectMaterials = isFaceMaterial === true ? object.material : null;\r\n\r\n\t\t\t\t\tfor ( var v = 0, vl = vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\t\t\t\tvar vertex = vertices[ v ];\r\n\r\n\t\t\t\t\t\t_vector3.copy( vertex );\r\n\r\n\t\t\t\t\t\tif ( material.morphTargets === true ) {\r\n\r\n\t\t\t\t\t\t\tvar morphTargets = geometry.morphTargets;\r\n\t\t\t\t\t\t\tvar morphInfluences = object.morphTargetInfluences;\r\n\r\n\t\t\t\t\t\t\tfor ( var t = 0, tl = morphTargets.length; t < tl; t ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvar influence = morphInfluences[ t ];\r\n\r\n\t\t\t\t\t\t\t\tif ( influence === 0 ) continue;\r\n\r\n\t\t\t\t\t\t\t\tvar target = morphTargets[ t ];\r\n\t\t\t\t\t\t\t\tvar targetVertex = target.vertices[ v ];\r\n\r\n\t\t\t\t\t\t\t\t_vector3.x += ( targetVertex.x - vertex.x ) * influence;\r\n\t\t\t\t\t\t\t\t_vector3.y += ( targetVertex.y - vertex.y ) * influence;\r\n\t\t\t\t\t\t\t\t_vector3.z += ( targetVertex.z - vertex.z ) * influence;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\trenderList.pushVertex( _vector3.x, _vector3.y, _vector3.z );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var f = 0, fl = faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\tvar face = faces[ f ];\r\n\r\n\t\t\t\t\t\tmaterial = isFaceMaterial === true\r\n\t\t\t\t\t\t\t ? objectMaterials.materials[ face.materialIndex ]\r\n\t\t\t\t\t\t\t : object.material;\r\n\r\n\t\t\t\t\t\tif ( material === undefined ) continue;\r\n\r\n\t\t\t\t\t\tvar side = material.side;\r\n\r\n\t\t\t\t\t\tvar v1 = _vertexPool[ face.a ];\r\n\t\t\t\t\t\tvar v2 = _vertexPool[ face.b ];\r\n\t\t\t\t\t\tvar v3 = _vertexPool[ face.c ];\r\n\r\n\t\t\t\t\t\tif ( renderList.checkTriangleVisibility( v1, v2, v3 ) === false ) continue;\r\n\r\n\t\t\t\t\t\tvar visible = renderList.checkBackfaceCulling( v1, v2, v3 );\r\n\r\n\t\t\t\t\t\tif ( side !== THREE.DoubleSide ) {\r\n\r\n\t\t\t\t\t\t\tif ( side === THREE.FrontSide && visible === false ) continue;\r\n\t\t\t\t\t\t\tif ( side === THREE.BackSide && visible === true ) continue;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_face = getNextFaceInPool();\r\n\r\n\t\t\t\t\t\t_face.id = object.id;\r\n\t\t\t\t\t\t_face.v1.copy( v1 );\r\n\t\t\t\t\t\t_face.v2.copy( v2 );\r\n\t\t\t\t\t\t_face.v3.copy( v3 );\r\n\r\n\t\t\t\t\t\t_face.normalModel.copy( face.normal );\r\n\r\n\t\t\t\t\t\tif ( visible === false && ( side === THREE.BackSide || side === THREE.DoubleSide ) ) {\r\n\r\n\t\t\t\t\t\t\t_face.normalModel.negate();\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_face.normalModel.applyMatrix3( _normalMatrix ).normalize();\r\n\r\n\t\t\t\t\t\tvar faceVertexNormals = face.vertexNormals;\r\n\r\n\t\t\t\t\t\tfor ( var n = 0, nl = Math.min( faceVertexNormals.length, 3 ); n < nl; n ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar normalModel = _face.vertexNormalsModel[ n ];\r\n\t\t\t\t\t\t\tnormalModel.copy( faceVertexNormals[ n ] );\r\n\r\n\t\t\t\t\t\t\tif ( visible === false && ( side === THREE.BackSide || side === THREE.DoubleSide ) ) {\r\n\r\n\t\t\t\t\t\t\t\tnormalModel.negate();\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tnormalModel.applyMatrix3( _normalMatrix ).normalize();\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_face.vertexNormalsLength = faceVertexNormals.length;\r\n\r\n\t\t\t\t\t\tvar vertexUvs = faceVertexUvs[ f ];\r\n\r\n\t\t\t\t\t\tif ( vertexUvs !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tfor ( var u = 0; u < 3; u ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t_face.uvs[ u ].copy( vertexUvs[ u ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_face.color = face.color;\r\n\t\t\t\t\t\t_face.material = material;\r\n\r\n\t\t\t\t\t\t_face.z = ( v1.positionScreen.z + v2.positionScreen.z + v3.positionScreen.z ) / 3;\r\n\t\t\t\t\t\t_face.renderOrder = object.renderOrder;\r\n\r\n\t\t\t\t\t\t_renderData.elements.push( _face );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object instanceof THREE.Line ) {\r\n\r\n\t\t\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\t\t\tvar attributes = geometry.attributes;\r\n\r\n\t\t\t\t\tif ( attributes.position !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = positions.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\trenderList.pushVertex( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( geometry.index !== null ) {\r\n\r\n\t\t\t\t\t\t\tvar indices = geometry.index.array;\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += 2 ) {\r\n\r\n\t\t\t\t\t\t\t\trenderList.pushLine( indices[ i ], indices[ i + 1 ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar step = object instanceof THREE.LineSegments ? 2 : 1;\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = ( positions.length / 3 ) - 1; i < l; i += step ) {\r\n\r\n\t\t\t\t\t\t\t\trenderList.pushLine( i, i + 1 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\t\t\t_modelViewProjectionMatrix.multiplyMatrices( _viewProjectionMatrix, _modelMatrix );\r\n\r\n\t\t\t\t\tvar vertices = object.geometry.vertices;\r\n\r\n\t\t\t\t\tif ( vertices.length === 0 ) continue;\r\n\r\n\t\t\t\t\tv1 = getNextVertexInPool();\r\n\t\t\t\t\tv1.positionScreen.copy( vertices[ 0 ] ).applyMatrix4( _modelViewProjectionMatrix );\r\n\r\n\t\t\t\t\tvar step = object instanceof THREE.LineSegments ? 2 : 1;\r\n\r\n\t\t\t\t\tfor ( var v = 1, vl = vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\t\t\t\tv1 = getNextVertexInPool();\r\n\t\t\t\t\t\tv1.positionScreen.copy( vertices[ v ] ).applyMatrix4( _modelViewProjectionMatrix );\r\n\r\n\t\t\t\t\t\tif ( ( v + 1 ) % step > 0 ) continue;\r\n\r\n\t\t\t\t\t\tv2 = _vertexPool[ _vertexCount - 2 ];\r\n\r\n\t\t\t\t\t\t_clippedVertex1PositionScreen.copy( v1.positionScreen );\r\n\t\t\t\t\t\t_clippedVertex2PositionScreen.copy( v2.positionScreen );\r\n\r\n\t\t\t\t\t\tif ( clipLine( _clippedVertex1PositionScreen, _clippedVertex2PositionScreen ) === true ) {\r\n\r\n\t\t\t\t\t\t\t// Perform the perspective divide\r\n\t\t\t\t\t\t\t_clippedVertex1PositionScreen.multiplyScalar( 1 / _clippedVertex1PositionScreen.w );\r\n\t\t\t\t\t\t\t_clippedVertex2PositionScreen.multiplyScalar( 1 / _clippedVertex2PositionScreen.w );\r\n\r\n\t\t\t\t\t\t\t_line = getNextLineInPool();\r\n\r\n\t\t\t\t\t\t\t_line.id = object.id;\r\n\t\t\t\t\t\t\t_line.v1.positionScreen.copy( _clippedVertex1PositionScreen );\r\n\t\t\t\t\t\t\t_line.v2.positionScreen.copy( _clippedVertex2PositionScreen );\r\n\r\n\t\t\t\t\t\t\t_line.z = Math.max( _clippedVertex1PositionScreen.z, _clippedVertex2PositionScreen.z );\r\n\t\t\t\t\t\t\t_line.renderOrder = object.renderOrder;\r\n\r\n\t\t\t\t\t\t\t_line.material = object.material;\r\n\r\n\t\t\t\t\t\t\tif ( object.material.vertexColors === THREE.VertexColors ) {\r\n\r\n\t\t\t\t\t\t\t\t_line.vertexColors[ 0 ].copy( object.geometry.colors[ v ] );\r\n\t\t\t\t\t\t\t\t_line.vertexColors[ 1 ].copy( object.geometry.colors[ v - 1 ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t_renderData.elements.push( _line );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object instanceof THREE.Sprite ) {\r\n\r\n\t\t\t\t_vector4.set( _modelMatrix.elements[ 12 ], _modelMatrix.elements[ 13 ], _modelMatrix.elements[ 14 ], 1 );\r\n\t\t\t\t_vector4.applyMatrix4( _viewProjectionMatrix );\r\n\r\n\t\t\t\tvar invW = 1 / _vector4.w;\r\n\r\n\t\t\t\t_vector4.z *= invW;\r\n\r\n\t\t\t\tif ( _vector4.z >= - 1 && _vector4.z <= 1 ) {\r\n\r\n\t\t\t\t\t_sprite = getNextSpriteInPool();\r\n\t\t\t\t\t_sprite.id = object.id;\r\n\t\t\t\t\t_sprite.x = _vector4.x * invW;\r\n\t\t\t\t\t_sprite.y = _vector4.y * invW;\r\n\t\t\t\t\t_sprite.z = _vector4.z;\r\n\t\t\t\t\t_sprite.renderOrder = object.renderOrder;\r\n\t\t\t\t\t_sprite.object = object;\r\n\r\n\t\t\t\t\t_sprite.rotation = object.rotation;\r\n\r\n\t\t\t\t\t_sprite.scale.x = object.scale.x * Math.abs( _sprite.x - ( _vector4.x + camera.projectionMatrix.elements[ 0 ] ) / ( _vector4.w + camera.projectionMatrix.elements[ 12 ] ) );\r\n\t\t\t\t\t_sprite.scale.y = object.scale.y * Math.abs( _sprite.y - ( _vector4.y + camera.projectionMatrix.elements[ 5 ] ) / ( _vector4.w + camera.projectionMatrix.elements[ 13 ] ) );\r\n\r\n\t\t\t\t\t_sprite.material = object.material;\r\n\r\n\t\t\t\t\t_renderData.elements.push( _sprite );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( sortElements === true ) {\r\n\r\n\t\t\t_renderData.elements.sort( painterSort );\r\n\r\n\t\t}\r\n\r\n\t\treturn _renderData;\r\n\r\n\t};\r\n\r\n\t// Pools\r\n\r\n\tfunction getNextObjectInPool() {\r\n\r\n\t\tif ( _objectCount === _objectPoolLength ) {\r\n\r\n\t\t\tvar object = new THREE.RenderableObject();\r\n\t\t\t_objectPool.push( object );\r\n\t\t\t_objectPoolLength ++;\r\n\t\t\t_objectCount ++;\r\n\t\t\treturn object;\r\n\r\n\t\t}\r\n\r\n\t\treturn _objectPool[ _objectCount ++ ];\r\n\r\n\t}\r\n\r\n\tfunction getNextVertexInPool() {\r\n\r\n\t\tif ( _vertexCount === _vertexPoolLength ) {\r\n\r\n\t\t\tvar vertex = new THREE.RenderableVertex();\r\n\t\t\t_vertexPool.push( vertex );\r\n\t\t\t_vertexPoolLength ++;\r\n\t\t\t_vertexCount ++;\r\n\t\t\treturn vertex;\r\n\r\n\t\t}\r\n\r\n\t\treturn _vertexPool[ _vertexCount ++ ];\r\n\r\n\t}\r\n\r\n\tfunction getNextFaceInPool() {\r\n\r\n\t\tif ( _faceCount === _facePoolLength ) {\r\n\r\n\t\t\tvar face = new THREE.RenderableFace();\r\n\t\t\t_facePool.push( face );\r\n\t\t\t_facePoolLength ++;\r\n\t\t\t_faceCount ++;\r\n\t\t\treturn face;\r\n\r\n\t\t}\r\n\r\n\t\treturn _facePool[ _faceCount ++ ];\r\n\r\n\r\n\t}\r\n\r\n\tfunction getNextLineInPool() {\r\n\r\n\t\tif ( _lineCount === _linePoolLength ) {\r\n\r\n\t\t\tvar line = new THREE.RenderableLine();\r\n\t\t\t_linePool.push( line );\r\n\t\t\t_linePoolLength ++;\r\n\t\t\t_lineCount ++;\r\n\t\t\treturn line;\r\n\r\n\t\t}\r\n\r\n\t\treturn _linePool[ _lineCount ++ ];\r\n\r\n\t}\r\n\r\n\tfunction getNextSpriteInPool() {\r\n\r\n\t\tif ( _spriteCount === _spritePoolLength ) {\r\n\r\n\t\t\tvar sprite = new THREE.RenderableSprite();\r\n\t\t\t_spritePool.push( sprite );\r\n\t\t\t_spritePoolLength ++;\r\n\t\t\t_spriteCount ++;\r\n\t\t\treturn sprite;\r\n\r\n\t\t}\r\n\r\n\t\treturn _spritePool[ _spriteCount ++ ];\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction painterSort( a, b ) {\r\n\r\n\t\tif ( a.renderOrder !== b.renderOrder ) {\r\n\r\n\t\t\treturn a.renderOrder - b.renderOrder;\r\n\r\n\t\t} else if ( a.z !== b.z ) {\r\n\r\n\t\t\treturn b.z - a.z;\r\n\r\n\t\t} else if ( a.id !== b.id ) {\r\n\r\n\t\t\treturn a.id - b.id;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn 0;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction clipLine( s1, s2 ) {\r\n\r\n\t\tvar alpha1 = 0, alpha2 = 1,\r\n\r\n\t\t// Calculate the boundary coordinate of each vertex for the near and far clip planes,\r\n\t\t// Z = -1 and Z = +1, respectively.\r\n\t\tbc1near =  s1.z + s1.w,\r\n\t\tbc2near =  s2.z + s2.w,\r\n\t\tbc1far =  - s1.z + s1.w,\r\n\t\tbc2far =  - s2.z + s2.w;\r\n\r\n\t\tif ( bc1near >= 0 && bc2near >= 0 && bc1far >= 0 && bc2far >= 0 ) {\r\n\r\n\t\t\t// Both vertices lie entirely within all clip planes.\r\n\t\t\treturn true;\r\n\r\n\t\t} else if ( ( bc1near < 0 && bc2near < 0 ) || ( bc1far < 0 && bc2far < 0 ) ) {\r\n\r\n\t\t\t// Both vertices lie entirely outside one of the clip planes.\r\n\t\t\treturn false;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// The line segment spans at least one clip plane.\r\n\r\n\t\t\tif ( bc1near < 0 ) {\r\n\r\n\t\t\t\t// v1 lies outside the near plane, v2 inside\r\n\t\t\t\talpha1 = Math.max( alpha1, bc1near / ( bc1near - bc2near ) );\r\n\r\n\t\t\t} else if ( bc2near < 0 ) {\r\n\r\n\t\t\t\t// v2 lies outside the near plane, v1 inside\r\n\t\t\t\talpha2 = Math.min( alpha2, bc1near / ( bc1near - bc2near ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( bc1far < 0 ) {\r\n\r\n\t\t\t\t// v1 lies outside the far plane, v2 inside\r\n\t\t\t\talpha1 = Math.max( alpha1, bc1far / ( bc1far - bc2far ) );\r\n\r\n\t\t\t} else if ( bc2far < 0 ) {\r\n\r\n\t\t\t\t// v2 lies outside the far plane, v2 inside\r\n\t\t\t\talpha2 = Math.min( alpha2, bc1far / ( bc1far - bc2far ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( alpha2 < alpha1 ) {\r\n\r\n\t\t\t\t// The line segment spans two boundaries, but is outside both of them.\r\n\t\t\t\t// (This can't happen when we're only clipping against just near/far but good\r\n\t\t\t\t//  to leave the check here for future usage if other clip planes are added.)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Update the s1 and s2 vertices to match the clipped line segment.\r\n\t\t\t\ts1.lerp( s2, alpha1 );\r\n\t\t\t\ts2.lerp( s1, 1 - alpha2 );\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};"]}