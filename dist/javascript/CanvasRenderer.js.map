{"version":3,"sources":["../../javascript/CanvasRenderer.js"],"names":[],"mappings":"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","file":"CanvasRenderer.js","sourcesContent":["/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.SpriteCanvasMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'SpriteCanvasMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\tthis.program = function ( context, color ) {};\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.SpriteCanvasMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.SpriteCanvasMaterial.prototype.constructor = THREE.SpriteCanvasMaterial;\r\n\r\nTHREE.SpriteCanvasMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.SpriteCanvasMaterial();\r\n\r\n\tmaterial.copy( this );\r\n\tmaterial.color.copy( this.color );\r\n\tmaterial.program = this.program;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.CanvasRenderer = function ( parameters ) {\r\n\r\n\tconsole.log( 'THREE.CanvasRenderer', THREE.REVISION );\r\n\r\n\tparameters = parameters || {};\r\n\r\n\tvar _this = this,\r\n\t_renderData, _elements, _lights,\r\n\t_projector = new THREE.Projector(),\r\n\r\n\t_canvas = parameters.canvas !== undefined\r\n\t\t\t ? parameters.canvas\r\n\t\t\t : document.createElement( 'canvas' ),\r\n\r\n\t_canvasWidth = _canvas.width,\r\n\t_canvasHeight = _canvas.height,\r\n\t_canvasWidthHalf = Math.floor( _canvasWidth / 2 ),\r\n\t_canvasHeightHalf = Math.floor( _canvasHeight / 2 ),\r\n\r\n\t_viewportX = 0,\r\n\t_viewportY = 0,\r\n\t_viewportWidth = _canvasWidth,\r\n\t_viewportHeight = _canvasHeight,\r\n\r\n\tpixelRatio = 1,\r\n\r\n\t_context = _canvas.getContext( '2d', {\r\n\t\talpha: parameters.alpha === true\r\n\t} ),\r\n\r\n\t_clearColor = new THREE.Color( 0x000000 ),\r\n\t_clearAlpha = parameters.alpha === true ? 0 : 1,\r\n\r\n\t_contextGlobalAlpha = 1,\r\n\t_contextGlobalCompositeOperation = 0,\r\n\t_contextStrokeStyle = null,\r\n\t_contextFillStyle = null,\r\n\t_contextLineWidth = null,\r\n\t_contextLineCap = null,\r\n\t_contextLineJoin = null,\r\n\t_contextLineDash = [],\r\n\r\n\t_camera,\r\n\r\n\t_v1, _v2, _v3, _v4,\r\n\t_v5 = new THREE.RenderableVertex(),\r\n\t_v6 = new THREE.RenderableVertex(),\r\n\r\n\t_v1x, _v1y, _v2x, _v2y, _v3x, _v3y,\r\n\t_v4x, _v4y, _v5x, _v5y, _v6x, _v6y,\r\n\r\n\t_color = new THREE.Color(),\r\n\t_color1 = new THREE.Color(),\r\n\t_color2 = new THREE.Color(),\r\n\t_color3 = new THREE.Color(),\r\n\t_color4 = new THREE.Color(),\r\n\r\n\t_diffuseColor = new THREE.Color(),\r\n\t_emissiveColor = new THREE.Color(),\r\n\r\n\t_lightColor = new THREE.Color(),\r\n\r\n\t_patterns = {},\r\n\r\n\t_image, _uvs,\r\n\t_uv1x, _uv1y, _uv2x, _uv2y, _uv3x, _uv3y,\r\n\r\n\t_clipBox = new THREE.Box2(),\r\n\t_clearBox = new THREE.Box2(),\r\n\t_elemBox = new THREE.Box2(),\r\n\r\n\t_ambientLight = new THREE.Color(),\r\n\t_directionalLights = new THREE.Color(),\r\n\t_pointLights = new THREE.Color(),\r\n\r\n\t_vector3 = new THREE.Vector3(), // Needed for PointLight\r\n\t_centroid = new THREE.Vector3(),\r\n\t_normal = new THREE.Vector3(),\r\n\t_normalViewMatrix = new THREE.Matrix3();\r\n\r\n\t// dash+gap fallbacks for Firefox and everything else\r\n\r\n\tif ( _context.setLineDash === undefined ) {\r\n\r\n\t\t_context.setLineDash = function () {}\r\n\r\n\t}\r\n\r\n\tthis.domElement = _canvas;\r\n\r\n\tthis.autoClear = true;\r\n\tthis.sortObjects = true;\r\n\tthis.sortElements = true;\r\n\r\n\tthis.info = {\r\n\r\n\t\trender: {\r\n\r\n\t\t\tvertices: 0,\r\n\t\t\tfaces: 0\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// WebGLRenderer compatibility\r\n\r\n\tthis.supportsVertexTextures = function () {};\r\n\tthis.setFaceCulling = function () {};\r\n\r\n\t// API\r\n\r\n\tthis.getContext = function () {\r\n\r\n\t\treturn _context;\r\n\r\n\t};\r\n\r\n\tthis.getContextAttributes = function () {\r\n\r\n\t\treturn _context.getContextAttributes();\r\n\r\n\t};\r\n\r\n\tthis.getPixelRatio = function () {\r\n\r\n\t\treturn pixelRatio;\r\n\r\n\t};\r\n\r\n\tthis.setPixelRatio = function ( value ) {\r\n\r\n\t\tif ( value !== undefined ) pixelRatio = value;\r\n\r\n\t};\r\n\r\n\tthis.setSize = function ( width, height, updateStyle ) {\r\n\r\n\t\t_canvasWidth = width * pixelRatio;\r\n\t\t_canvasHeight = height * pixelRatio;\r\n\r\n\t\t_canvas.width = _canvasWidth;\r\n\t\t_canvas.height = _canvasHeight;\r\n\r\n\t\t_canvasWidthHalf = Math.floor( _canvasWidth / 2 );\r\n\t\t_canvasHeightHalf = Math.floor( _canvasHeight / 2 );\r\n\r\n\t\tif ( updateStyle !== false ) {\r\n\r\n\t\t\t_canvas.style.width = width + 'px';\r\n\t\t\t_canvas.style.height = height + 'px';\r\n\r\n\t\t}\r\n\r\n\t\t_clipBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t_clipBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\r\n\t\t_clearBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t_clearBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\r\n\t\t_contextGlobalAlpha = 1;\r\n\t\t_contextGlobalCompositeOperation = 0;\r\n\t\t_contextStrokeStyle = null;\r\n\t\t_contextFillStyle = null;\r\n\t\t_contextLineWidth = null;\r\n\t\t_contextLineCap = null;\r\n\t\t_contextLineJoin = null;\r\n\r\n\t\tthis.setViewport( 0, 0, width, height );\r\n\r\n\t};\r\n\r\n\tthis.setViewport = function ( x, y, width, height ) {\r\n\r\n\t\t_viewportX = x * pixelRatio;\r\n\t\t_viewportY = y * pixelRatio;\r\n\r\n\t\t_viewportWidth = width * pixelRatio;\r\n\t\t_viewportHeight = height * pixelRatio;\r\n\r\n\t};\r\n\r\n\tthis.setScissor = function () {};\r\n\tthis.enableScissorTest = function () {};\r\n\r\n\tthis.setClearColor = function ( color, alpha ) {\r\n\r\n\t\t_clearColor.set( color );\r\n\t\t_clearAlpha = alpha !== undefined ? alpha : 1;\r\n\r\n\t\t_clearBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t_clearBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\r\n\t};\r\n\r\n\tthis.setClearColorHex = function ( hex, alpha ) {\r\n\r\n\t\tconsole.warn( 'THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.' );\r\n\t\tthis.setClearColor( hex, alpha );\r\n\r\n\t};\r\n\r\n\tthis.getClearColor = function () {\r\n\r\n\t\treturn _clearColor;\r\n\r\n\t};\r\n\r\n\tthis.getClearAlpha = function () {\r\n\r\n\t\treturn _clearAlpha;\r\n\r\n\t};\r\n\r\n\tthis.getMaxAnisotropy = function () {\r\n\r\n\t\treturn 0;\r\n\r\n\t};\r\n\r\n\tthis.clear = function () {\r\n\r\n\t\tif ( _clearBox.empty() === false ) {\r\n\r\n\t\t\t_clearBox.intersect( _clipBox );\r\n\t\t\t_clearBox.expandByScalar( 2 );\r\n\r\n\t\t\t_clearBox.min.x = _clearBox.min.x + _canvasWidthHalf;\r\n\t\t\t_clearBox.min.y =  - _clearBox.min.y + _canvasHeightHalf;\t\t// higher y value !\r\n\t\t\t_clearBox.max.x = _clearBox.max.x + _canvasWidthHalf;\r\n\t\t\t_clearBox.max.y =  - _clearBox.max.y + _canvasHeightHalf;\t\t// lower y value !\r\n\r\n\t\t\tif ( _clearAlpha < 1 ) {\r\n\r\n\t\t\t\t_context.clearRect(\r\n\t\t\t\t\t_clearBox.min.x | 0,\r\n\t\t\t\t\t_clearBox.max.y | 0,\r\n\t\t\t\t\t( _clearBox.max.x - _clearBox.min.x ) | 0,\r\n\t\t\t\t\t( _clearBox.min.y - _clearBox.max.y ) | 0\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _clearAlpha > 0 ) {\r\n\r\n\t\t\t\tsetBlending( THREE.NormalBlending );\r\n\t\t\t\tsetOpacity( 1 );\r\n\r\n\t\t\t\tsetFillStyle( 'rgba(' + Math.floor( _clearColor.r * 255 ) + ',' + Math.floor( _clearColor.g * 255 ) + ',' + Math.floor( _clearColor.b * 255 ) + ',' + _clearAlpha + ')' );\r\n\r\n\t\t\t\t_context.fillRect(\r\n\t\t\t\t\t_clearBox.min.x | 0,\r\n\t\t\t\t\t_clearBox.max.y | 0,\r\n\t\t\t\t\t( _clearBox.max.x - _clearBox.min.x ) | 0,\r\n\t\t\t\t\t( _clearBox.min.y - _clearBox.max.y ) | 0\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_clearBox.makeEmpty();\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// compatibility\r\n\r\n\tthis.clearColor = function () {};\r\n\tthis.clearDepth = function () {};\r\n\tthis.clearStencil = function () {};\r\n\r\n\tthis.render = function ( scene, camera ) {\r\n\r\n\t\tif ( camera instanceof THREE.Camera === false ) {\r\n\r\n\t\t\tconsole.error( 'THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.autoClear === true ) this.clear();\r\n\r\n\t\t_this.info.render.vertices = 0;\r\n\t\t_this.info.render.faces = 0;\r\n\r\n\t\t_context.setTransform( _viewportWidth / _canvasWidth, 0, 0, - _viewportHeight / _canvasHeight, _viewportX, _canvasHeight - _viewportY );\r\n\t\t_context.translate( _canvasWidthHalf, _canvasHeightHalf );\r\n\r\n\t\t_renderData = _projector.projectScene( scene, camera, this.sortObjects, this.sortElements );\r\n\t\t_elements = _renderData.elements;\r\n\t\t_lights = _renderData.lights;\r\n\t\t_camera = camera;\r\n\r\n\t\t_normalViewMatrix.getNormalMatrix( camera.matrixWorldInverse );\r\n\r\n\t\t/* DEBUG\r\n\t\tsetFillStyle( 'rgba( 0, 255, 255, 0.5 )' );\r\n\t\t_context.fillRect( _clipBox.min.x, _clipBox.min.y, _clipBox.max.x - _clipBox.min.x, _clipBox.max.y - _clipBox.min.y );\r\n\t\t*/\r\n\r\n\t\tcalculateLights();\r\n\r\n\t\tfor ( var e = 0, el = _elements.length; e < el; e ++ ) {\r\n\r\n\t\t\tvar element = _elements[ e ];\r\n\r\n\t\t\tvar material = element.material;\r\n\r\n\t\t\tif ( material === undefined || material.opacity === 0 ) continue;\r\n\r\n\t\t\t_elemBox.makeEmpty();\r\n\r\n\t\t\tif ( element instanceof THREE.RenderableSprite ) {\r\n\r\n\t\t\t\t_v1 = element;\r\n\t\t\t\t_v1.x *= _canvasWidthHalf; _v1.y *= _canvasHeightHalf;\r\n\r\n\t\t\t\trenderSprite( _v1, element, material );\r\n\r\n\t\t\t} else if ( element instanceof THREE.RenderableLine ) {\r\n\r\n\t\t\t\t_v1 = element.v1; _v2 = element.v2;\r\n\r\n\t\t\t\t_v1.positionScreen.x *= _canvasWidthHalf; _v1.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t_v2.positionScreen.x *= _canvasWidthHalf; _v2.positionScreen.y *= _canvasHeightHalf;\r\n\r\n\t\t\t\t_elemBox.setFromPoints( [\r\n\t\t\t\t\t_v1.positionScreen,\r\n\t\t\t\t\t_v2.positionScreen\r\n\t\t\t\t] );\r\n\r\n\t\t\t\tif ( _clipBox.isIntersectionBox( _elemBox ) === true ) {\r\n\r\n\t\t\t\t\trenderLine( _v1, _v2, element, material );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( element instanceof THREE.RenderableFace ) {\r\n\r\n\t\t\t\t_v1 = element.v1; _v2 = element.v2; _v3 = element.v3;\r\n\r\n\t\t\t\tif ( _v1.positionScreen.z < - 1 || _v1.positionScreen.z > 1 ) continue;\r\n\t\t\t\tif ( _v2.positionScreen.z < - 1 || _v2.positionScreen.z > 1 ) continue;\r\n\t\t\t\tif ( _v3.positionScreen.z < - 1 || _v3.positionScreen.z > 1 ) continue;\r\n\r\n\t\t\t\t_v1.positionScreen.x *= _canvasWidthHalf; _v1.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t_v2.positionScreen.x *= _canvasWidthHalf; _v2.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t_v3.positionScreen.x *= _canvasWidthHalf; _v3.positionScreen.y *= _canvasHeightHalf;\r\n\r\n\t\t\t\tif ( material.overdraw > 0 ) {\r\n\r\n\t\t\t\t\texpand( _v1.positionScreen, _v2.positionScreen, material.overdraw );\r\n\t\t\t\t\texpand( _v2.positionScreen, _v3.positionScreen, material.overdraw );\r\n\t\t\t\t\texpand( _v3.positionScreen, _v1.positionScreen, material.overdraw );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_elemBox.setFromPoints( [\r\n\t\t\t\t\t_v1.positionScreen,\r\n\t\t\t\t\t_v2.positionScreen,\r\n\t\t\t\t\t_v3.positionScreen\r\n\t\t\t\t] );\r\n\r\n\t\t\t\tif ( _clipBox.isIntersectionBox( _elemBox ) === true ) {\r\n\r\n\t\t\t\t\trenderFace3( _v1, _v2, _v3, 0, 1, 2, element, material );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t/* DEBUG\r\n\t\t\tsetLineWidth( 1 );\r\n\t\t\tsetStrokeStyle( 'rgba( 0, 255, 0, 0.5 )' );\r\n\t\t\t_context.strokeRect( _elemBox.min.x, _elemBox.min.y, _elemBox.max.x - _elemBox.min.x, _elemBox.max.y - _elemBox.min.y );\r\n\t\t\t*/\r\n\r\n\t\t\t_clearBox.union( _elemBox );\r\n\r\n\t\t}\r\n\r\n\t\t/* DEBUG\r\n\t\tsetLineWidth( 1 );\r\n\t\tsetStrokeStyle( 'rgba( 255, 0, 0, 0.5 )' );\r\n\t\t_context.strokeRect( _clearBox.min.x, _clearBox.min.y, _clearBox.max.x - _clearBox.min.x, _clearBox.max.y - _clearBox.min.y );\r\n\t\t*/\r\n\r\n\t\t_context.setTransform( 1, 0, 0, 1, 0, 0 );\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tfunction calculateLights() {\r\n\r\n\t\t_ambientLight.setRGB( 0, 0, 0 );\r\n\t\t_directionalLights.setRGB( 0, 0, 0 );\r\n\t\t_pointLights.setRGB( 0, 0, 0 );\r\n\r\n\t\tfor ( var l = 0, ll = _lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tvar light = _lights[ l ];\r\n\t\t\tvar lightColor = light.color;\r\n\r\n\t\t\tif ( light instanceof THREE.AmbientLight ) {\r\n\r\n\t\t\t\t_ambientLight.add( lightColor );\r\n\r\n\t\t\t} else if ( light instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\t// for sprites\r\n\r\n\t\t\t\t_directionalLights.add( lightColor );\r\n\r\n\t\t\t} else if ( light instanceof THREE.PointLight ) {\r\n\r\n\t\t\t\t// for sprites\r\n\r\n\t\t\t\t_pointLights.add( lightColor );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction calculateLight( position, normal, color ) {\r\n\r\n\t\tfor ( var l = 0, ll = _lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tvar light = _lights[ l ];\r\n\r\n\t\t\t_lightColor.copy( light.color );\r\n\r\n\t\t\tif ( light instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\tvar lightPosition = _vector3.setFromMatrixPosition( light.matrixWorld ).normalize();\r\n\r\n\t\t\t\tvar amount = normal.dot( lightPosition );\r\n\r\n\t\t\t\tif ( amount <= 0 ) continue;\r\n\r\n\t\t\t\tamount *= light.intensity;\r\n\r\n\t\t\t\tcolor.add( _lightColor.multiplyScalar( amount ) );\r\n\r\n\t\t\t} else if ( light instanceof THREE.PointLight ) {\r\n\r\n\t\t\t\tvar lightPosition = _vector3.setFromMatrixPosition( light.matrixWorld );\r\n\r\n\t\t\t\tvar amount = normal.dot( _vector3.subVectors( lightPosition, position ).normalize() );\r\n\r\n\t\t\t\tif ( amount <= 0 ) continue;\r\n\r\n\t\t\t\tamount *= light.distance == 0 ? 1 : 1 - Math.min( position.distanceTo( lightPosition ) / light.distance, 1 );\r\n\r\n\t\t\t\tif ( amount == 0 ) continue;\r\n\r\n\t\t\t\tamount *= light.intensity;\r\n\r\n\t\t\t\tcolor.add( _lightColor.multiplyScalar( amount ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderSprite( v1, element, material ) {\r\n\r\n\t\tsetOpacity( material.opacity );\r\n\t\tsetBlending( material.blending );\r\n\r\n\t\tvar scaleX = element.scale.x * _canvasWidthHalf;\r\n\t\tvar scaleY = element.scale.y * _canvasHeightHalf;\r\n\r\n\t\tvar dist = 0.5 * Math.sqrt( scaleX * scaleX + scaleY * scaleY ); // allow for rotated sprite\r\n\t\t_elemBox.min.set( v1.x - dist, v1.y - dist );\r\n\t\t_elemBox.max.set( v1.x + dist, v1.y + dist );\r\n\r\n\t\tif ( material instanceof THREE.SpriteMaterial ) {\r\n\r\n\t\t\tvar texture = material.map;\r\n\r\n\t\t\tif ( texture !== null ) {\r\n\r\n\t\t\t\tvar pattern = _patterns[ texture.id ];\r\n\r\n\t\t\t\tif ( pattern === undefined || pattern.version !== texture.version ) {\r\n\r\n\t\t\t\t\tpattern = textureToPattern( texture );\r\n\t\t\t\t\t_patterns[ texture.id ] = pattern;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pattern.canvas !== undefined ) {\r\n\r\n\t\t\t\t\tsetFillStyle( pattern.canvas );\r\n\r\n\t\t\t\t\tvar bitmap = texture.image;\r\n\r\n\t\t\t\t\tvar ox = bitmap.width * texture.offset.x;\r\n\t\t\t\t\tvar oy = bitmap.height * texture.offset.y;\r\n\r\n\t\t\t\t\tvar sx = bitmap.width * texture.repeat.x;\r\n\t\t\t\t\tvar sy = bitmap.height * texture.repeat.y;\r\n\r\n\t\t\t\t\tvar cx = scaleX / sx;\r\n\t\t\t\t\tvar cy = scaleY / sy;\r\n\r\n\t\t\t\t\t_context.save();\r\n\t\t\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t\t\t_context.translate( - scaleX / 2, - scaleY / 2 );\r\n\t\t\t\t\t_context.scale( cx, cy );\r\n\t\t\t\t\t_context.translate( - ox, - oy );\r\n\t\t\t\t\t_context.fillRect( ox, oy, sx, sy );\r\n\t\t\t\t\t_context.restore();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// no texture\r\n\r\n\t\t\t\tsetFillStyle( material.color.getStyle() );\r\n\r\n\t\t\t\t_context.save();\r\n\t\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t\t_context.scale( scaleX, - scaleY );\r\n\t\t\t\t_context.fillRect( - 0.5, - 0.5, 1, 1 );\r\n\t\t\t\t_context.restore();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( material instanceof THREE.SpriteCanvasMaterial ) {\r\n\r\n\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\t\t\tsetFillStyle( material.color.getStyle() );\r\n\r\n\t\t\t_context.save();\r\n\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t_context.scale( scaleX, scaleY );\r\n\r\n\t\t\tmaterial.program( _context );\r\n\r\n\t\t\t_context.restore();\r\n\r\n\t\t}\r\n\r\n\t\t/* DEBUG\r\n\t\tsetStrokeStyle( 'rgb(255,255,0)' );\r\n\t\t_context.beginPath();\r\n\t\t_context.moveTo( v1.x - 10, v1.y );\r\n\t\t_context.lineTo( v1.x + 10, v1.y );\r\n\t\t_context.moveTo( v1.x, v1.y - 10 );\r\n\t\t_context.lineTo( v1.x, v1.y + 10 );\r\n\t\t_context.stroke();\r\n\t\t*/\r\n\r\n\t}\r\n\r\n\tfunction renderLine( v1, v2, element, material ) {\r\n\r\n\t\tsetOpacity( material.opacity );\r\n\t\tsetBlending( material.blending );\r\n\r\n\t\t_context.beginPath();\r\n\t\t_context.moveTo( v1.positionScreen.x, v1.positionScreen.y );\r\n\t\t_context.lineTo( v2.positionScreen.x, v2.positionScreen.y );\r\n\r\n\t\tif ( material instanceof THREE.LineBasicMaterial ) {\r\n\r\n\t\t\tsetLineWidth( material.linewidth );\r\n\t\t\tsetLineCap( material.linecap );\r\n\t\t\tsetLineJoin( material.linejoin );\r\n\r\n\t\t\tif ( material.vertexColors !== THREE.VertexColors ) {\r\n\r\n\t\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar colorStyle1 = element.vertexColors[ 0 ].getStyle();\r\n\t\t\t\tvar colorStyle2 = element.vertexColors[ 1 ].getStyle();\r\n\r\n\t\t\t\tif ( colorStyle1 === colorStyle2 ) {\r\n\r\n\t\t\t\t\tsetStrokeStyle( colorStyle1 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\tvar grad = _context.createLinearGradient(\r\n\t\t\t\t\t\t\tv1.positionScreen.x,\r\n\t\t\t\t\t\t\tv1.positionScreen.y,\r\n\t\t\t\t\t\t\tv2.positionScreen.x,\r\n\t\t\t\t\t\t\tv2.positionScreen.y\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tgrad.addColorStop( 0, colorStyle1 );\r\n\t\t\t\t\t\tgrad.addColorStop( 1, colorStyle2 );\r\n\r\n\t\t\t\t\t} catch ( exception ) {\r\n\r\n\t\t\t\t\t\tgrad = colorStyle1;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsetStrokeStyle( grad );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_context.stroke();\r\n\t\t\t_elemBox.expandByScalar( material.linewidth * 2 );\r\n\r\n\t\t} else if ( material instanceof THREE.LineDashedMaterial ) {\r\n\r\n\t\t\tsetLineWidth( material.linewidth );\r\n\t\t\tsetLineCap( material.linecap );\r\n\t\t\tsetLineJoin( material.linejoin );\r\n\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\t\t\tsetLineDash( [ material.dashSize, material.gapSize ] );\r\n\r\n\t\t\t_context.stroke();\r\n\r\n\t\t\t_elemBox.expandByScalar( material.linewidth * 2 );\r\n\r\n\t\t\tsetLineDash( [] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderFace3( v1, v2, v3, uv1, uv2, uv3, element, material ) {\r\n\r\n\t\t_this.info.render.vertices += 3;\r\n\t\t_this.info.render.faces ++;\r\n\r\n\t\tsetOpacity( material.opacity );\r\n\t\tsetBlending( material.blending );\r\n\r\n\t\t_v1x = v1.positionScreen.x; _v1y = v1.positionScreen.y;\r\n\t\t_v2x = v2.positionScreen.x; _v2y = v2.positionScreen.y;\r\n\t\t_v3x = v3.positionScreen.x; _v3y = v3.positionScreen.y;\r\n\r\n\t\tdrawTriangle( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y );\r\n\r\n\t\tif ( ( material instanceof THREE.MeshLambertMaterial || material instanceof THREE.MeshPhongMaterial ) && material.map === null ) {\r\n\r\n\t\t\t_diffuseColor.copy( material.color );\r\n\t\t\t_emissiveColor.copy( material.emissive );\r\n\r\n\t\t\tif ( material.vertexColors === THREE.FaceColors ) {\r\n\r\n\t\t\t\t_diffuseColor.multiply( element.color );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_color.copy( _ambientLight );\r\n\r\n\t\t\t_centroid.copy( v1.positionWorld ).add( v2.positionWorld ).add( v3.positionWorld ).divideScalar( 3 );\r\n\r\n\t\t\tcalculateLight( _centroid, element.normalModel, _color );\r\n\r\n\t\t\t_color.multiply( _diffuseColor ).add( _emissiveColor );\r\n\r\n\t\t\tmaterial.wireframe === true\r\n\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t : fillPath( _color );\r\n\r\n\t\t} else if ( material instanceof THREE.MeshBasicMaterial ||\r\n\t\t\t\t    material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t    material instanceof THREE.MeshPhongMaterial ) {\r\n\r\n\t\t\tif ( material.map !== null ) {\r\n\r\n\t\t\t\tvar mapping = material.map.mapping;\r\n\r\n\t\t\t\tif ( mapping === THREE.UVMapping ) {\r\n\r\n\t\t\t\t\t_uvs = element.uvs;\r\n\t\t\t\t\tpatternPath( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y, _uvs[ uv1 ].x, _uvs[ uv1 ].y, _uvs[ uv2 ].x, _uvs[ uv2 ].y, _uvs[ uv3 ].x, _uvs[ uv3 ].y, material.map );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( material.envMap !== null ) {\r\n\r\n\t\t\t\tif ( material.envMap.mapping === THREE.SphericalReflectionMapping ) {\r\n\r\n\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv1 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t_uv1x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t_uv1y = 0.5 * _normal.y + 0.5;\r\n\r\n\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv2 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t_uv2x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t_uv2y = 0.5 * _normal.y + 0.5;\r\n\r\n\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv3 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t_uv3x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t_uv3y = 0.5 * _normal.y + 0.5;\r\n\r\n\t\t\t\t\tpatternPath( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y, _uv1x, _uv1y, _uv2x, _uv2y, _uv3x, _uv3y, material.envMap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_color.copy( material.color );\r\n\r\n\t\t\t\tif ( material.vertexColors === THREE.FaceColors ) {\r\n\r\n\t\t\t\t\t_color.multiply( element.color );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterial.wireframe === true\r\n\t\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t\t : fillPath( _color );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( material instanceof THREE.MeshNormalMaterial ) {\r\n\r\n\t\t\t_normal.copy( element.normalModel ).applyMatrix3( _normalViewMatrix );\r\n\r\n\t\t\t_color.setRGB( _normal.x, _normal.y, _normal.z ).multiplyScalar( 0.5 ).addScalar( 0.5 );\r\n\r\n\t\t\tmaterial.wireframe === true\r\n\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t : fillPath( _color );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_color.setRGB( 1, 1, 1 );\r\n\r\n\t\t\tmaterial.wireframe === true\r\n\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t : fillPath( _color );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction drawTriangle( x0, y0, x1, y1, x2, y2 ) {\r\n\r\n\t\t_context.beginPath();\r\n\t\t_context.moveTo( x0, y0 );\r\n\t\t_context.lineTo( x1, y1 );\r\n\t\t_context.lineTo( x2, y2 );\r\n\t\t_context.closePath();\r\n\r\n\t}\r\n\r\n\tfunction strokePath( color, linewidth, linecap, linejoin ) {\r\n\r\n\t\tsetLineWidth( linewidth );\r\n\t\tsetLineCap( linecap );\r\n\t\tsetLineJoin( linejoin );\r\n\t\tsetStrokeStyle( color.getStyle() );\r\n\r\n\t\t_context.stroke();\r\n\r\n\t\t_elemBox.expandByScalar( linewidth * 2 );\r\n\r\n\t}\r\n\r\n\tfunction fillPath( color ) {\r\n\r\n\t\tsetFillStyle( color.getStyle() );\r\n\t\t_context.fill();\r\n\r\n\t}\r\n\r\n\tfunction textureToPattern( texture ) {\r\n\r\n\t\tif ( texture.version === 0 ||\r\n\t\t\ttexture instanceof THREE.CompressedTexture ||\r\n\t\t\ttexture instanceof THREE.DataTexture ) {\r\n\r\n\t\t\treturn {\r\n\t\t\t\t\tcanvas: undefined,\r\n\t\t\t\t\tversion: texture.version\r\n\t\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar image = texture.image;\r\n\r\n\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\tcanvas.width = image.width;\r\n\t\tcanvas.height = image.height;\r\n\r\n\t\tvar context = canvas.getContext( '2d' );\r\n\t\tcontext.setTransform( 1, 0, 0, - 1, 0, image.height );\r\n\t\tcontext.drawImage( image, 0, 0 );\r\n\r\n\t\tvar repeatX = texture.wrapS === THREE.RepeatWrapping;\r\n\t\tvar repeatY = texture.wrapT === THREE.RepeatWrapping;\r\n\r\n\t\tvar repeat = 'no-repeat';\r\n\r\n\t\tif ( repeatX === true && repeatY === true ) {\r\n\r\n\t\t\trepeat = 'repeat';\r\n\r\n\t\t} else if ( repeatX === true ) {\r\n\r\n\t\t\trepeat = 'repeat-x';\r\n\r\n\t\t} else if ( repeatY === true ) {\r\n\r\n\t\t\trepeat = 'repeat-y';\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tcanvas: _context.createPattern( canvas, repeat ),\r\n\t\t\tversion: texture.version\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction patternPath( x0, y0, x1, y1, x2, y2, u0, v0, u1, v1, u2, v2, texture ) {\r\n\r\n\t\tvar pattern = _patterns[ texture.id ];\r\n\r\n\t\tif ( pattern === undefined || pattern.version !== texture.version ) {\r\n\r\n\t\t\tpattern = textureToPattern( texture );\r\n\t\t\t_patterns[ texture.id ] = pattern;\r\n\r\n\t\t}\r\n\r\n\t\tif ( pattern.canvas !== undefined ) {\r\n\r\n\t\t\tsetFillStyle( pattern.canvas );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tsetFillStyle( 'rgba( 0, 0, 0, 1)' );\r\n\t\t\t_context.fill();\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// http://extremelysatisfactorytotalitarianism.com/blog/?p=2120\r\n\r\n\t\tvar a, b, c, d, e, f, det, idet,\r\n\t\toffsetX = texture.offset.x / texture.repeat.x,\r\n\t\toffsetY = texture.offset.y / texture.repeat.y,\r\n\t\twidth = texture.image.width * texture.repeat.x,\r\n\t\theight = texture.image.height * texture.repeat.y;\r\n\r\n\t\tu0 = ( u0 + offsetX ) * width;\r\n\t\tv0 = ( v0 + offsetY ) * height;\r\n\r\n\t\tu1 = ( u1 + offsetX ) * width;\r\n\t\tv1 = ( v1 + offsetY ) * height;\r\n\r\n\t\tu2 = ( u2 + offsetX ) * width;\r\n\t\tv2 = ( v2 + offsetY ) * height;\r\n\r\n\t\tx1 -= x0; y1 -= y0;\r\n\t\tx2 -= x0; y2 -= y0;\r\n\r\n\t\tu1 -= u0; v1 -= v0;\r\n\t\tu2 -= u0; v2 -= v0;\r\n\r\n\t\tdet = u1 * v2 - u2 * v1;\r\n\r\n\t\tif ( det === 0 ) return;\r\n\r\n\t\tidet = 1 / det;\r\n\r\n\t\ta = ( v2 * x1 - v1 * x2 ) * idet;\r\n\t\tb = ( v2 * y1 - v1 * y2 ) * idet;\r\n\t\tc = ( u1 * x2 - u2 * x1 ) * idet;\r\n\t\td = ( u1 * y2 - u2 * y1 ) * idet;\r\n\r\n\t\te = x0 - a * u0 - c * v0;\r\n\t\tf = y0 - b * u0 - d * v0;\r\n\r\n\t\t_context.save();\r\n\t\t_context.transform( a, b, c, d, e, f );\r\n\t\t_context.fill();\r\n\t\t_context.restore();\r\n\r\n\t}\r\n\r\n\tfunction clipImage( x0, y0, x1, y1, x2, y2, u0, v0, u1, v1, u2, v2, image ) {\r\n\r\n\t\t// http://extremelysatisfactorytotalitarianism.com/blog/?p=2120\r\n\r\n\t\tvar a, b, c, d, e, f, det, idet,\r\n\t\twidth = image.width - 1,\r\n\t\theight = image.height - 1;\r\n\r\n\t\tu0 *= width; v0 *= height;\r\n\t\tu1 *= width; v1 *= height;\r\n\t\tu2 *= width; v2 *= height;\r\n\r\n\t\tx1 -= x0; y1 -= y0;\r\n\t\tx2 -= x0; y2 -= y0;\r\n\r\n\t\tu1 -= u0; v1 -= v0;\r\n\t\tu2 -= u0; v2 -= v0;\r\n\r\n\t\tdet = u1 * v2 - u2 * v1;\r\n\r\n\t\tidet = 1 / det;\r\n\r\n\t\ta = ( v2 * x1 - v1 * x2 ) * idet;\r\n\t\tb = ( v2 * y1 - v1 * y2 ) * idet;\r\n\t\tc = ( u1 * x2 - u2 * x1 ) * idet;\r\n\t\td = ( u1 * y2 - u2 * y1 ) * idet;\r\n\r\n\t\te = x0 - a * u0 - c * v0;\r\n\t\tf = y0 - b * u0 - d * v0;\r\n\r\n\t\t_context.save();\r\n\t\t_context.transform( a, b, c, d, e, f );\r\n\t\t_context.clip();\r\n\t\t_context.drawImage( image, 0, 0 );\r\n\t\t_context.restore();\r\n\r\n\t}\r\n\r\n\t// Hide anti-alias gaps\r\n\r\n\tfunction expand( v1, v2, pixels ) {\r\n\r\n\t\tvar x = v2.x - v1.x, y = v2.y - v1.y,\r\n\t\tdet = x * x + y * y, idet;\r\n\r\n\t\tif ( det === 0 ) return;\r\n\r\n\t\tidet = pixels / Math.sqrt( det );\r\n\r\n\t\tx *= idet; y *= idet;\r\n\r\n\t\tv2.x += x; v2.y += y;\r\n\t\tv1.x -= x; v1.y -= y;\r\n\r\n\t}\r\n\r\n\t// Context cached methods.\r\n\r\n\tfunction setOpacity( value ) {\r\n\r\n\t\tif ( _contextGlobalAlpha !== value ) {\r\n\r\n\t\t\t_context.globalAlpha = value;\r\n\t\t\t_contextGlobalAlpha = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setBlending( value ) {\r\n\r\n\t\tif ( _contextGlobalCompositeOperation !== value ) {\r\n\r\n\t\t\tif ( value === THREE.NormalBlending ) {\r\n\r\n\t\t\t\t_context.globalCompositeOperation = 'source-over';\r\n\r\n\t\t\t} else if ( value === THREE.AdditiveBlending ) {\r\n\r\n\t\t\t\t_context.globalCompositeOperation = 'lighter';\r\n\r\n\t\t\t} else if ( value === THREE.SubtractiveBlending ) {\r\n\r\n\t\t\t\t_context.globalCompositeOperation = 'darker';\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_contextGlobalCompositeOperation = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineWidth( value ) {\r\n\r\n\t\tif ( _contextLineWidth !== value ) {\r\n\r\n\t\t\t_context.lineWidth = value;\r\n\t\t\t_contextLineWidth = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineCap( value ) {\r\n\r\n\t\t// \"butt\", \"round\", \"square\"\r\n\r\n\t\tif ( _contextLineCap !== value ) {\r\n\r\n\t\t\t_context.lineCap = value;\r\n\t\t\t_contextLineCap = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineJoin( value ) {\r\n\r\n\t\t// \"round\", \"bevel\", \"miter\"\r\n\r\n\t\tif ( _contextLineJoin !== value ) {\r\n\r\n\t\t\t_context.lineJoin = value;\r\n\t\t\t_contextLineJoin = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setStrokeStyle( value ) {\r\n\r\n\t\tif ( _contextStrokeStyle !== value ) {\r\n\r\n\t\t\t_context.strokeStyle = value;\r\n\t\t\t_contextStrokeStyle = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setFillStyle( value ) {\r\n\r\n\t\tif ( _contextFillStyle !== value ) {\r\n\r\n\t\t\t_context.fillStyle = value;\r\n\t\t\t_contextFillStyle = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineDash( value ) {\r\n\r\n\t\tif ( _contextLineDash.length !== value.length ) {\r\n\r\n\t\t\t_context.setLineDash( value );\r\n\t\t\t_contextLineDash = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};"]}